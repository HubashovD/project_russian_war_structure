<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html>

<head>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/js/uikit-icons.min.js"></script>

    <body>
        <div id='main-header'>Наскільки велика російська армія?</div>
        <div id='lead'></div>
        <p>Скільки бойових підрозділів Російська Федерація вже задіяла у війні з Україною? Чи є десь у "степах забайкалля" ще одна російська армія із потужною технікою, яку показують на парадах до "Дна перемоги"?</p>
        <!--Путін Хуйло-->
        <div class='usual_text_block'></div>
        <div id='selectors'>
            <select id="district_selector">
            <option value="Западный военный округ">Западный военный округ</option>
            <option value="Північний флот">Північний флот</option>
            <option value="Східний військовий округ">Східний військовий округ</option>
            <option value="Центральный военный округ">Центральный военный округ</option>
            <option value="Южный военный округ">Южный военный округ</option>
        </select>
            <button id='svitcher'>Відобразити ієрархію</button>
            <button id='total-selection'>Умікни все!</button>
        </div>



        <div id='main_div'>
            <div class="main_grid" id="main_grid">
                <div class="box1" id="box1">
                    <div id="ierarchy"></div>
                </div>
                <div class="box2" id="box2">
                    <div uk-sticky="map_sticky" id="sticky">
                        <div id='map'></div>
                        <div id="box3"> Наведіть на точку на карті для отримання детальної інформації</div>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/ierarchy.js"></script>
        <script src="js/list.js"></script>
        <script src="js/map.js"></script>
        <!-- <script scr="js/map_ rev2.js"></script> -->
        <script>
        </script>
        <script>
            function options() {

                criminals = document.getElementsByClassName("Yes")
                    //console.log(criminals)

                for (var i = 0; i < criminals.length; i++) {
                    if (criminals[i].localName == 'circle') {
                        //console.log(criminals[i].localName)
                        //console.log(criminals[i])
                        //console.log("criminals: " + i)
                        criminals[i].style.color = 'red';
                        criminals[i].style.stroke = 'red';
                    } else if (criminals[i].localName == 'li') {
                        //criminals[i].style.color = 'red';
                        criminals[i].style.color = "red";
                    } else {
                        //console.log('not_circle')
                    }

                }

                d3.csv("map.csv", function(data) {
                    //console.log(data)
                    var unit_list = []
                    data.forEach(function(d) {
                        unit_list.push({
                            unit: d.unit_en
                        })
                    });

                    //console.log(link)
                    unit_list.forEach(function(d) {
                        var photo = document.getElementsByClassName(d.unit); //перебираємо кожен підрозділ, який є класом
                        //console.log(photo)
                        for (var i = 0; i < photo.length; i++) { // перебираємо кожен елемент у списку класів
                            //console.log(photo[i])
                            //console.log(photo[i].length)
                            try { // для кожного елементу із списку класів додаємо властивість, якщо елемента немає в списку - пропускаємо
                                photo[i].onmouseover = function() {
                                    try {
                                        description = document.getElementById("box3")

                                        while (description.firstChild) {
                                            description.removeChild(description.firstChild);
                                        }
                                        //console.log(description)
                                        //console.log(this.classList[0])
                                        try {
                                            f = this.classList[0]
                                                //console.log(f)
                                            var filtered_unit = data.filter(function(d) {
                                                return d.unit_en === f
                                            })
                                            console.log(filtered_unit[0])

                                            text =
                                                "<b>Назва підрозділу:</b> " +
                                                filtered_unit[0].unit + "<br>" +
                                                "<b>Підрозділ командування:</b> " +
                                                filtered_unit[0].division + "<br>" +
                                                "<b>Армія:</b> " + filtered_unit[0].army + ", " + filtered_unit[0].district + "<br>" +
                                                "<b>Місце дислокації:</b> " + filtered_unit[0].city + ", " + filtered_unit[0].region + "<br>" +
                                                "<b>Військова частина</b> " + filtered_unit[0].mil_part

                                        } catch {}

                                        //console.log(text)

                                        var child = document.createElement('div');
                                        child.innerHTML = text
                                        child.classList.add("total-description")
                                            //console.log(child)
                                        description.appendChild(child);
                                    } catch {}

                                    elements = document.getElementsByClassName(d.unit)
                                        //console.log(elements)
                                        //texts = elements.selectAll('text')
                                        //console.log(texts)

                                    for (var i = 0; i < elements.length; i++) {
                                        //console.log(elements[i])
                                        if (elements[i].localName == 'circle') {
                                            //console.log("circle")
                                            //elements[i].style.color = 'green';
                                            //elements[i].style.stroke = 'red';
                                            elements[i].style.r = "10"
                                        } else if (elements[i].localName == 'text') {
                                            //console.log("text")
                                            elements[i].style.color = 'red';
                                            elements[i].style.stroke = 'red'
                                            elements[i].style.font = "14px proxima-medium";
                                        } else if (elements[i].localName == 'li') {
                                            //console.log(elements[i])
                                            elements[i].style.font = "18px proxima-medium";

                                        } else if (elements[i].localName == 'path') { // Лінії на карті приховані, і підсвічуються лише при наведенні
                                            //console.log("path")
                                            elements[i].style.strokewidth = "5px";
                                            elements[i].style.stroke = 'red';
                                            elements[i].style.opacity = "1";
                                        } else {}
                                        //підсвічуємо назв населених пунктів та точки в Україні
                                        //console.log(elements[i])
                                        try {
                                            var myClass = this.classList;
                                            //console.log(myClass[0]);
                                            //text_label = map_svg.selectAll(myClass[0] + " text_explainer")
                                            text_label = document.getElementsByClassName(myClass[0] + " text-explainer")
                                                //console.log(text_label[0])
                                            text_label[0].style.opacity = "1";
                                        } catch {}
                                        try {
                                            war_point = document.getElementsByClassName(myClass[0] + " war-point")
                                            war_point[0].style.opacity = "1";
                                        } catch {}

                                        try {
                                            war_explainer = document.getElementsByClassName(myClass[0] + " war-explainer")
                                            war_explainer[0].style.opacity = "1";
                                        } catch {}
                                        //war_point = document.getElementsByClassName(myClass[0] + " war_point")
                                        //war_point[0].style.opacity = "1";

                                        //war_explainer = document.getElementsByClassName(myClass[0] + " war_explainer")
                                        //war_point[0].style.opacity = "1";

                                        //text_explainer = document.getElementsByClassName(myClass[0] + " text_explainer")
                                        //console.log(text_explainer)
                                        //map_circles = 
                                        //console.log(map_circles)
                                        //map_circles = document.getElementsByClassName(myClass[0] + " map-circle")
                                        //console.log(map_circles[0].parentNode)

                                        //text_explainer = map_circles[0].parentNode
                                        //text_explainer
                                        //    .append("g")
                                        //map_circles = document.getElementsByClassName("map-circle")
                                        //map_circles = document.querySelector(elements[i] + " map-circle")
                                        //console.log(map_circles)
                                        /*for (var i = 0; i < map_circles.length; i++) {
                                            console.log(map_circles[i])
                                            console.log(map_circles.selelect(elements[i]))
                                                //if (map_circles[i].classList[0] === elements[i]) {
                                                //    console.log("map " + elements[i].classList[0])
                                                //} else {}
                                        } */
                                    }
                                };
                                photo[i].onmouseleave = function() {
                                    try {
                                        description = document.getElementById("box3")

                                        while (description.firstChild) {
                                            description.removeChild(description.firstChild);
                                        }
                                    } catch {}
                                    elements = document.getElementsByClassName(d.unit)
                                        //console.log(elements)
                                    for (var i = 0; i < elements.length; i++) {
                                        //console.log(elements[i])
                                        if (elements[i].localName == 'circle') {
                                            //console.log("circle")
                                            //elements[i].style.stroke = 'black';
                                            elements[i].style.r = "3"
                                                //elements[i].style.stroke = "None"
                                                //elements[i].style.color = 'black';
                                        } else if (elements[i].localName == 'text') {
                                            //console.log("text")
                                            elements[i].style.color = 'black';
                                            elements[i].style.stroke = "None"
                                            elements[i].style.font = "10px proxima-medium";
                                        } else if (elements[i].localName == 'li') {
                                            //console.log(elements[i])
                                            elements[i].style.font = "14px proxima-medium";
                                        } else if (elements[i].localName == 'path') {
                                            //console.log("path")
                                            elements[i].style.strokewidth = "1px";
                                            elements[i].style.stroke = 'black';
                                            elements[i].style.opacity = "0";
                                        } else {}

                                        // прибираємо підсвітку назв населених пунктів та точки в Україні
                                        try {
                                            var myClass = this.classList;
                                            //console.log(myClass[0]);
                                            //text_label = map_svg.selectAll(myClass[0] + " text_explainer")
                                            text_label = document.getElementsByClassName(myClass[0] + " text-explainer")
                                                //console.log(text_label[0])
                                            text_label[0].style.opacity = "0"
                                        } catch {}

                                        try {
                                            war_point = document.getElementsByClassName(myClass[0] + " war-point")
                                            war_point[0].style.opacity = "0";
                                        } catch {}
                                        try {
                                            war_explainer = document.getElementsByClassName(myClass[0] + " war-explainer")
                                            war_explainer[0].style.opacity = "0";
                                        } catch {}
                                    }
                                }
                                photo[i].onclick = function() {}
                            } catch {
                                continue
                            }
                        };
                    })
                })
            }
        </script>>
        <script>
            options()
        </script>
        <script>
            function selectTotal() {
                show = false
                    //console.log("start show " + show)
                butTotal = document.getElementById("total-selection")
                    //console.log(butTotal)
                butTotal.onclick = function() {
                    //console.log("start show " + show)
                    if (show === false) {
                        criminals = document.getElementsByClassName("Yes")
                            //console.log(criminals)
                        for (var i = 0; i < criminals.length; i++) {
                            if (criminals[i].localName == 'path') {
                                criminals[i].style.stroke = 'red'
                                criminals[i].style.opacity = '1'
                            } else {}
                        }
                        show = true
                        butTotal
                        //console.log("show path")
                    } else {
                        criminals = document.getElementsByClassName("Yes")
                            //console.log(criminals)
                        for (var i = 0; i < criminals.length; i++) {
                            if (criminals[i].localName == 'path') {
                                criminals[i].style.stroke = 'red'
                                criminals[i].style.opacity = '0'
                            } else {}
                        }
                        show = false
                            //console.log("hide path")
                    }
                    //console.log("end show " + show)
                    return show
                }
            }
            selectTotal()
        </script>
        <script>
            function svitch_this() {
                flag = "list"
                butswitcher = document.getElementById("svitcher")
                butswitcher.onclick = function() {
                    if (flag == "list") {
                        console.log(butswitcher)
                        butswitcher.innerHTML = 'Список та карта'
                        flag = "ierarchy"

                        main_div = document.getElementById("main_div")
                        while (main_div.firstChild) {
                            main_div.removeChild(main_div.firstChild);
                        }

                        var ierarchy = document.createElement('div');
                        ierarchy.classList.add("ierarchy")
                        ierarchy.setAttribute('id', 'ierarchy')
                            //ierarchy.setAttribute('height', '99vh')
                            //child.id.add("cbox2")
                        main_div.appendChild(ierarchy);
                        totalSelectionBut = document.getElementById("total-selection")
                        totalSelectionBut.remove()

                        status = document.getElementById('district_selector')
                        console.log(status)

                        ierarchyPainter()
                    } else {
                        butswitcher.innerHTML = 'Відобразити ієрархію'
                        flag = "list"

                        main_div = document.getElementById("main_div")
                        while (main_div.firstChild) {
                            main_div.removeChild(main_div.firstChild);
                        }

                        maingrid = document.createElement('div');
                        maingrid.classList.add("main_grid")
                        maingrid.setAttribute('id', 'main_grid')
                        main_div.appendChild(maingrid);

                        var box1 = document.createElement('div');
                        box1.classList.add("box1")
                        box1.setAttribute('id', 'box1')
                            //child.id.add("cbox2")
                        maingrid.appendChild(box1);

                        var ierarchy = document.createElement('div');
                        ierarchy.classList.add("ierarchy")
                        ierarchy.setAttribute('id', 'ierarchy')
                            //child.id.add("cbox2")
                        box1.appendChild(ierarchy);

                        var box2 = document.createElement('div');
                        box2.classList.add("box2")
                        box2.setAttribute('id', 'box2')
                            //child.id.add("cbox2")
                        maingrid.appendChild(box2);

                        var stickybox = document.createElement('div');
                        stickybox.classList.add("sticky")
                        stickybox.setAttribute('id', 'sticky')
                        stickybox.setAttribute('uk-sticky', 'map_sticky')
                            //child.id.add("cbox2")
                        box2.appendChild(stickybox);

                        var mapbox = document.createElement('div');
                        mapbox.setAttribute('id', 'map')
                        stickybox.appendChild(mapbox);
                        var box3 = document.createElement('div');
                        box3.setAttribute('id', 'box3')
                        stickybox.appendChild(box3);

                        var buttonsBlock = document.getElementById("selectors")
                        var totalSelectionBut = document.createElement('button');
                        totalSelectionBut.setAttribute('id', 'total-selection')
                        totalSelectionBut.innerHTML = 'Умікни усе!'
                            //totalSelectionBut.setAttribute('height', '10px')
                        buttonsBlock.appendChild(totalSelectionBut);

                        selectTotal()
                        listPainter()
                        mapPainter()
                    }

                }
                return flag
            }
            svitch_this()
            listPainter()
        </script>
    </body>

</html>