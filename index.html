<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html>

<head>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.3/dist/js/uikit-icons.min.js"></script>

    <body>
        <div id='main-header'>Наскільки велика російська армія?</div>
        <div id='lead'></div>
        <p>Скільки бойових підрозділів Російська Федерація вже задіяла у війні з Україною? Чи є десь у "степах забайкалля" ще одна російська армія із потужною технікою, яку показують на парадах до "Дна перемоги"?</p>
        <!--Путін Хуйло-->
        <div class='usual_text_block'>
        </div>
        <div id='selectors'>
            <select id="district_selector">
            <option value="Західний військовий округ">Західний військовий округ</option>
            <option value="Північний флот">Північний флот</option>
            <option value="Східний військовий округ">Східний військовий округ</option>
            <option value="Центральний військовий округ">Центральний військовий округ</option>
            <option value="Південний військовий округ">Південний військовий округ</option>
        </select>
        </div>



        <div id='main_div'>
            <div class="main_grid" id="main_grid">
                <div class="box1" id="box1">
                    <div id="ierarchy"></div>
                </div>
                <div class="box2" id="box2">
                    <div uk-sticky="map_sticky" id="sticky">
                        <div>
                            <p id='map-explainer'>
                                Оберіть військовий округ із списку та наведіть назву на підрозділ щоб отримати додаткову інформацію
                            </p>
                        </div>
                        <div id='map'></div>
                        <div id="box3"> Наведіть на точку на карті для отримання детальної інформації</div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function options() {
                console.log('options')
                    // Підсвічуємо точки, лінії та текст підрозділів, які беруть участь у повномасштабному вторгенні
                criminals = document.getElementsByClassName("Yes")
                    //console.log(criminals)

                for (var i = 0; i < criminals.length; i++) {
                    if (criminals[i].localName == 'circle') {
                        criminals[i].style.fill = 'red';
                        criminals[i].style.opacity = 0.5;
                        //} else if (criminals[i].localName == 'li') {
                        //    criminals[i].style.color = "red";
                    } else if (criminals[i].localName == 'path') {
                        criminals[i].style.stroke = "red";
                    } else if (criminals[i].localName == 'text') {
                        criminals[i].style.opacity = 1;
                    } else {}

                }

                d3.csv("/data/map.csv", function(data) {
                    //console.log(data)
                    var unit_list = []
                    data.forEach(function(d) {
                        unit_list.push({
                            unit: d.unit_en
                        })
                    });

                    unit_list.forEach(function(d) {
                        var photo = document.getElementsByClassName(d.unit); //перебираємо кожен підрозділ, який є класом
                        for (var i = 0; i < photo.length; i++) { // перебираємо кожен елемент у списку класів
                            // для кожного елементу із списку класів додаємо властивість, якщо елемента немає в списку - пропускаємо
                            photo[i].onmouseover = function() {
                                try {
                                    description = document.getElementById("box3")
                                    while (description.firstChild) {
                                        description.removeChild(description.firstChild);
                                    }
                                    //console.log(description)
                                    //console.log(this.classList[0])
                                    f = this.classList[0]
                                        //console.log(f)
                                    var filtered_unit = data.filter(function(d) {
                                            return d.unit_en === f
                                        })
                                        //console.log(filtered_unit[0])

                                    // додаємо блок із описом
                                    var child = document.createElement('div');
                                    child.classList.add("total-description")
                                    description.appendChild(child);

                                    // додаємо перший заголовок
                                    var header_desk_text =
                                        "НАЗВА ПІДРОЗДІЛУ:"
                                    var header_desk = document.createElement('p');
                                    header_desk.innerHTML = header_desk_text
                                    header_desk.classList.add("total-description-header")
                                    child.appendChild(header_desk);

                                    var desk_text =
                                        filtered_unit[0].unit
                                    var desk_text_el = document.createElement('p');
                                    desk_text_el.innerHTML = desk_text
                                    desk_text_el.classList.add("total-description-text")
                                    child.appendChild(desk_text_el);

                                    var header_desk_text =
                                        "ПІДРОЗДІЛ КОМАНДУВАННЯ:"
                                    var header_desk = document.createElement('p');
                                    header_desk.innerHTML = header_desk_text
                                    header_desk.classList.add("total-description-header")
                                    child.appendChild(header_desk);

                                    var desk_text =
                                        filtered_unit[0].division
                                    var desk_text_el = document.createElement('p');
                                    desk_text_el.innerHTML = desk_text
                                    desk_text_el.classList.add("total-description-text")
                                    child.appendChild(desk_text_el);

                                    var header_desk_text =
                                        "АРМІЯ:"
                                    var header_desk = document.createElement('p');
                                    header_desk.innerHTML = header_desk_text
                                    header_desk.classList.add("total-description-header")
                                    child.appendChild(header_desk);

                                    var desk_text =
                                        filtered_unit[0].army + ", " + filtered_unit[0].district
                                    var desk_text_el = document.createElement('p');
                                    desk_text_el.innerHTML = desk_text
                                    desk_text_el.classList.add("total-description-text")
                                    child.appendChild(desk_text_el);

                                    var header_desk_text =
                                        "МІСЦЕ ДИСЛОКАЦІЇ:"
                                    var header_desk = document.createElement('p');
                                    header_desk.innerHTML = header_desk_text
                                    header_desk.classList.add("total-description-header")
                                    child.appendChild(header_desk);

                                    var desk_text =
                                        filtered_unit[0].city + ", " + filtered_unit[0].region
                                    var desk_text_el = document.createElement('p');
                                    desk_text_el.innerHTML = desk_text
                                    desk_text_el.classList.add("total-description-text")
                                    child.appendChild(desk_text_el);

                                    var header_desk_text =
                                        "ВІЙСЬКОВА ЧАСТИНА:"
                                    var header_desk = document.createElement('p');
                                    header_desk.innerHTML = header_desk_text
                                    header_desk.classList.add("total-description-header")
                                    child.appendChild(header_desk);

                                    var desk_text =
                                        filtered_unit[0].mil_part
                                    var desk_text_el = document.createElement('p');
                                    desk_text_el.innerHTML = desk_text
                                    desk_text_el.classList.add("total-description-text")
                                    child.appendChild(desk_text_el);


                                } catch {}

                                elements = document.getElementsByClassName(d.unit)
                                    // параметри для всіх елементів, на які наводиться мишка
                                for (var i = 0; i < elements.length; i++) {
                                    if (elements[i].localName == 'circle') {
                                        elements[i].style.r = "10"
                                    } else if (elements[i].localName == 'text') {
                                        elements[i].style.font = "14px proxima-medium";
                                        if (elements[i].classList.contains("war-explainer-text"))
                                            elements[i].style.opacity = "1";
                                        else {}
                                    } else if (elements[i].localName == 'rect') {
                                        elements[i].style.opacity = "1";
                                    } else if (elements[i].localName == 'path') { // Лінії на карті приховані, і підсвічуються лише при наведенні
                                        if (elements[i].classList.contains('link')) {
                                            // для ліній на ієрархії
                                            elements[i].style.strokewidth = "20px";
                                            //console.log('Link')
                                        } else {
                                            // для ліній на карті
                                            elements[i].style.strokewidth = "5px";
                                            elements[i].style.opacity = "1";
                                        }
                                    } else {}
                                    //підсвічуємо назв населених пунктів та точки в Україні
                                    try {
                                        var myClass = this.classList;
                                        text_label = document.getElementsByClassName(myClass[0] + " text-explainer")
                                        text_label[0].style.opacity = "1";
                                    } catch {}
                                    try {
                                        war_point = document.getElementsByClassName(myClass[0] + " war-point")
                                        war_point[0].style.opacity = "1";
                                    } catch {}

                                    try {
                                        war_explainer = document.getElementsByClassName(myClass[0] + " war-explainer")
                                        war_explainer[0].style.opacity = "1";
                                    } catch {}
                                }
                            };
                            photo[i].onmouseleave = function() {
                                // прибрав автоматичне видалення обраних точок
                                /*try {
                                    description = document.getElementById("box3")

                                    while (description.firstChild) {
                                        description.removeChild(description.firstChild);
                                    }
                                } catch {} */
                                elements = document.getElementsByClassName(d.unit)
                                for (var i = 0; i < elements.length; i++) {
                                    if (elements[i].localName == 'circle') {
                                        elements[i].style.r = "3"
                                    } else if (elements[i].localName == 'text') {
                                        elements[i].style.font = "10px proxima-medium";
                                        if (elements[i].classList.contains("war-explainer-text"))
                                            elements[i].style.opacity = "0";
                                        else {}
                                    } else if (elements[i].localName == 'li') {
                                        //console.log(elements[i])
                                        elements[i].style.font = "14px proxima-medium";
                                    } else if (elements[i].localName == 'rect') {
                                        elements[i].style.opacity = "0";
                                    } else if (elements[i].localName == 'path') {
                                        if (elements[i].classList.contains('link')) {
                                            // для ліній на ієрархії
                                        } else {
                                            // для ліній на карті 
                                            elements[i].style.opacity = "0";
                                        }
                                    } else {}

                                    // прибираємо підсвітку назв населених пунктів та точки в Україні
                                    try {
                                        var myClass = this.classList;
                                        text_label = document.getElementsByClassName(myClass[0] + " text-explainer")
                                        text_label[0].style.opacity = "0"
                                    } catch {}

                                    try {
                                        war_point = document.getElementsByClassName(myClass[0] + " war-point")
                                        war_point[0].style.opacity = "0";
                                    } catch {}
                                    try {
                                        war_explainer = document.getElementsByClassName(myClass[0] + " war-explainer")
                                        war_explainer[0].style.opacity = "0";
                                    } catch {}
                                }
                            }
                            photo[i].onclick = function() {}
                        };
                    })
                })
            }
        </script>
        <script>
            options()
        </script>
        <script src="js/ierarchy.js"></script>
        <!-- <script src="js/list.js"></script> -->
        <script src="js/map.js"></script>
        <!-- <script scr="js/map_ rev2.js"></script> -->
        <script>
            mapPainter()
        </script>
        <script>
            function colored_links() {
                console.log("colored_links")
                d3.csv("/data/map.csv", function(data) {
                    //console.log(data)
                    var link = []
                    data.forEach(function(d) {
                        if (d.crimes == "Yes") { // перелік підрозділів, які вчиняли зловчини
                            //console.log(d.unit_en)
                            link.push({
                                unit_en: d.unit_en
                            })
                        } else {}
                    })
                    console.log(link)

                    link.forEach(function(d) { // перебираємо підрозіділи, які є злочинцями
                        //console.log(d)
                        var selected = Array.from(document.getElementsByClassName(d.unit_en))
                        selected.forEach(function(d) {
                            d.classList.forEach(function(c) {
                                if (c == 'link') {
                                    d.style.stroke = 'red'
                                } else if (c == 'circle') {
                                    d.style.fill = 'red'
                                }
                            })
                        })
                    })
                })
            }
        </script>
        <script>
            colored_links()
        </script>
    </body>

</html>